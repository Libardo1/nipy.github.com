dependencies:
  pre:
    - sudo rm -rf /usr/bin/ruby1.8 
    - sudo rm -rf /usr/bin/ruby 
    - sudo rm -rf /usr/lib/ruby 
    - sudo rm -rf /usr/bin/X11/ruby1.8 
    - sudo rm -rf /usr/bin/X11/ruby 
    - sudo rm -rf /usr/share/man/man1/ruby.1.gz
    - sudo curl -sSL https://get.rvm.io | bash -s stable --ruby
    - rvm reload
    - rvm install 2.1.0
    - rvm reinstall 2.1.0
    - rvm use 2.1.0 --default
    - gem install jekyll
    - gem install jekyll-paginate

general:
  artifacts:
    - "./_site"

test:
  override:
    - BASEURL=https://circle-artifacts.com/gh/$CIRCLE_USERNAME/nipy.github.com/$CIRCLE_PREVIOUS_BUILD_NUM/artifacts/0/home/ubuntu/nipy.github.com/_site/
    - echo $BASEURL
    - sed -i "s,/,$BASEURL,g" "_config.yml"
    - sed -i "11 s,.*,baseurl: $BASEURL,g" "_config.yml"
    - jekyll build
